<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
        <div>
            <p ID="messages"></p>
        </div>
        <div class="bottom-element">
            <table class="center">
                <tr>
                    <td>
                        <button onclick="func1()">refresh messages</button>
                    </td>
                    <td>
                        <input type="text" ID="message_input" placeholder="message">
                    </td>
                    <td>
                        <button onclick="func2()">Send message</button>
                    </td>
                </tr>
            </table>
        </div>
    </body>

    <style>
        .center {
            margin-left: auto;
            margin-right: auto;
        }
        p {
            font-size: large;
            color: #e7e7e7;
        }
        body {
            background-color: #1e1e1e;
        }
        input {
            color: #e7e7e7;
            background-color: #2a2a2a;
            height: 50px;
            width: 400px;
        }
        .bottom-element {
            position: fixed;
            bottom: 0;
        }
        button {
            height: 50px;
            padding: 1%;
            background-color: #e7e7e7;
        }
        button:hover {
            background-color: lightsteelblue;
        }
    </style>

    <script>
        let user_name = prompt("please enter your name")

        const contentSocket = new WebSocket("localhost")

        contentSocket.onopen = function(event) {
            contentSocket.send("Socket open")
            console.log("websocket open")
        }

        contentSocket.onmessage = function(event) {
            console.log("recieved: " + event.data)
            func1() // refresh content
        }

        function func1() {
            const request = new XMLHttpRequest(); // create new HTTP request
            request.open('GET', '/content'); // request /content
            request.onreadystatechange = function() { // runs when request is returned 
                if (request.readyState === 4 && request.status === 200) { // make sure return suceeded 
                    document.getElementById("messages").innerText = request.responseText + "\n\n\n\n" // replace page content with returned text
                }
            }
            request.send() // send the request (that previous function will run when it is returned)
        }
        function func2() {
            const request = new XMLHttpRequest(); // create new HTTP request
            var data = { // create object to send to server 
                "name": user_name, // name field
                "message": document.getElementById("message_input").value // message field
            };

            request.open('POST', '/message'); // open POST request
            request.setRequestHeader("Content-Type", "application/json"); // let server know to expect JSON
            request.send(JSON.stringify(data)); // send that bih
            document.getElementById("message_input").value = ""
            func1(); // refresh content to see your message (should be run when request is returned but isnt)
        }
    </script>
</html>